# Backend, Frontend –∂”ô–Ω–µ –ë–∞–∑–∞ –î–µ—Ä–µ–∫—Ç–µ—Ä—ñ –ë–∞–π–ª–∞–Ω—ã—Å—Ç–∞—Ä—ã –¢–µ–∫—Å–µ—Ä—É—ñ

## üîç –ê–Ω—ã“õ—Ç–∞–ª“ì–∞–Ω –º”ô—Å–µ–ª–µ–ª–µ—Ä

### 1. **Next.js –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Å—ã –º”ô—Å–µ–ª–µ—Å—ñ** ‚ö†Ô∏è

#### –ü—Ä–æ–±–ª–µ–º–∞:
Next.js-—Ç–µ frontend –∂”ô–Ω–µ backend –±—ñ—Ä–¥–µ–π —Å–µ—Ä–≤–µ—Ä–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ (API routes `/api/...`). –ë—ñ—Ä–∞“õ Docker-–¥–∞ –µ–∫—ñ –±”©–ª–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±–∞—Ä:
- `backend` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (–ø–æ—Ä—Ç 3001)
- `frontend` –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ (–ø–æ—Ä—Ç 3000)

–ë“±–ª –º”ô—Å–µ–ª–µ–ª—ñ, —Å–µ–±–µ–±—ñ:
- Next.js API routes –±—ñ—Ä–¥–µ–π —Å–µ—Ä–≤–µ—Ä–¥–µ frontend-–ø–µ–Ω –±—ñ—Ä–≥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ
- –ë”©–ª–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä “õ–∞–∂–µ—Ç –µ–º–µ—Å
- Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—Ç–µ—Ä `/api/...` –ø–∞–π–¥–∞–ª–∞–Ω–∞–¥—ã (relative path) - –±“±–ª –¥“±—Ä—ã—Å
- Server –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—Ç–µ—Ä `NEXT_PUBLIC_BASE_URL` –ø–∞–π–¥–∞–ª–∞–Ω–∞–¥—ã - Docker-–¥–∞ –º”ô—Å–µ–ª–µ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω

#### –®–µ—à—É:
Next.js-—Ç–µ –±—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–µ—Ç–∫—ñ–ª—ñ–∫—Ç—ñ. –ï–∫—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–¥—ñ –±—ñ—Ä—ñ–∫—Ç—ñ—Ä—É –∫–µ—Ä–µ–∫.

---

### 2. **Backend ‚Üî Database –±–∞–π–ª–∞–Ω—ã—Å—ã** ‚úÖ

#### –¢–µ–∫—Å–µ—Ä—É:
- ‚úÖ DATABASE_URL –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω: `postgresql://mediacatalog:mediacatalog123@postgres:5432/mediacatalog?schema=public`
- ‚úÖ Backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ `postgres` hostname-—ñ –∞—Ä“õ—ã–ª—ã –±–∞–∑–∞“ì–∞ “õ–æ—Å—ã–ª–∞–¥—ã (Docker –∂–µ–ª—ñ –∞—Ä“õ—ã–ª—ã)
- ‚úÖ `depends_on` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω (postgres healthy –±–æ–ª“ì–∞–Ω–Ω–∞–Ω –∫–µ–π—ñ–Ω backend —ñ—Å–∫–µ “õ–æ—Å—ã–ª–∞–¥—ã)
- ‚úÖ Prisma –º–∏–≥—Ä–∞—Ü–∏—è–ª–∞—Ä—ã –¥“±—Ä—ã—Å –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –î“±—Ä—ã—Å –±–∞–π–ª–∞–Ω—ã—Å“õ–∞–Ω

---

### 3. **Frontend ‚Üî Backend –±–∞–π–ª–∞–Ω—ã—Å—ã** ‚ö†Ô∏è

#### –¢–µ–∫—Å–µ—Ä—É:
- ‚úÖ Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—Ç–µ—Ä `/api/...` –ø–∞–π–¥–∞–ª–∞–Ω–∞–¥—ã (relative path) - –¥“±—Ä—ã—Å
- ‚ö†Ô∏è Server –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—Ç–µ—Ä `NEXT_PUBLIC_BASE_URL` –ø–∞–π–¥–∞–ª–∞–Ω–∞–¥—ã - Docker-–¥–∞ –º”ô—Å–µ–ª–µ –±–æ–ª—É—ã –º“Ø–º–∫—ñ–Ω
- ‚ö†Ô∏è Docker-–¥–∞ frontend –∂”ô–Ω–µ backend –±”©–ª–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä - –º”ô—Å–µ–ª–µ–ª—ñ

**–ú”ô—Å–µ–ª–µ–ª–µ—Ä:**
1. Server –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—Ç–µ—Ä `NEXT_PUBLIC_BASE_URL` –ø–∞–π–¥–∞–ª–∞–Ω–∞–¥—ã, –±—ñ—Ä–∞“õ Docker-–¥–∞ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend-–∫–µ “õ–∞–ª–∞–π “õ–æ—Å—ã–ª–∞–¥—ã?
2. –ï–≥–µ—Ä frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend-–∫–µ “õ–æ—Å—ã–ª—É—ã –∫–µ—Ä–µ–∫ –±–æ–ª—Å–∞, `NEXT_PUBLIC_BASE_URL` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª—É—ã –∫–µ—Ä–µ–∫

**–®–µ—à—É:**
- Docker-–¥–∞ –±—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É (Next.js —Å—Ç–∞–Ω–¥–∞—Ä—Ç—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Å—ã)
- –ù–µ–º–µ—Å–µ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–Ω–¥–µ `NEXT_PUBLIC_BASE_URL=http://backend:3000` –±–∞–ø—Ç–∞—É

---

### 4. **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä –∞—Ä–∞—Å—ã–Ω–¥–∞“ì—ã –±–∞–π–ª–∞–Ω—ã—Å** ‚ö†Ô∏è

#### –¢–µ–∫—Å–µ—Ä—É:
- ‚úÖ –ë–∞—Ä–ª—ã“õ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä –±—ñ—Ä –∂–µ–ª—ñ–¥–µ (`mediacatalog-network`)
- ‚úÖ Backend `postgres` hostname-—ñ –∞—Ä“õ—ã–ª—ã –±–∞–∑–∞“ì–∞ “õ–æ—Å—ã–ª–∞–¥—ã
- ‚ö†Ô∏è Frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend-–∫–µ “õ–∞–ª–∞–π “õ–æ—Å—ã–ª–∞–¥—ã? (–µ–≥–µ—Ä –±”©–ª–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä –±–æ–ª—Å–∞)

**–ú”ô—Å–µ–ª–µ:**
- Frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ backend-–∫–µ `backend:3000` –∞—Ä“õ—ã–ª—ã “õ–æ—Å—ã–ª—É—ã –∫–µ—Ä–µ–∫
- –ë—ñ—Ä–∞“õ client-side –∫–æ–¥—Ç–∞ `/api/...` –ø–∞–π–¥–∞–ª–∞–Ω—ã–ª–∞–¥—ã, –±“±–ª –±—Ä–∞—É–∑–µ—Ä–¥–µ –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã
- –ë—Ä–∞—É–∑–µ—Ä `backend:3000` hostname-—ñ–Ω —Ç–∞–±–∞ –∞–ª–º–∞–π–¥—ã (Docker –∂–µ–ª—ñ —ñ—à—ñ–Ω–¥–µ)

**–®–µ—à—É:**
- Next.js-—Ç–µ –±—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É (–µ–Ω “õ–∞—Ä–∞–ø–∞–π—ã–º)
- –ù–µ–º–µ—Å–µ reverse proxy –ø–∞–π–¥–∞–ª–∞–Ω—É (nginx)

---

## ‚úÖ “∞—Å—ã–Ω—ã–ª“ì–∞–Ω —à–µ—à—É

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (“∞—Å—ã–Ω—ã–ª–∞–¥—ã) ‚úÖ

Next.js-—Ç–µ frontend –∂”ô–Ω–µ backend –±—ñ—Ä–¥–µ–π —Å–µ—Ä–≤–µ—Ä–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ, —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω –±—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–µ—Ç–∫—ñ–ª—ñ–∫—Ç—ñ.

**docker-compose.yml ”©–∑–≥–µ—Ä—ñ—Å—ñ:**
```yaml
services:
  postgres:
    # ... (”©–∑–≥–µ—Ä—ñ—Å—Å—ñ–∑)

  app:  # backend –∂”ô–Ω–µ frontend –±—ñ—Ä–≥–µ
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mediacatalog-app
    restart: unless-stopped
    ports:
      - "${APP_PORT:-3000}:3000"
    environment:
      - NODE_ENV=production
      - DATABASE_URL=postgresql://${POSTGRES_USER:-mediacatalog}:${POSTGRES_PASSWORD:-mediacatalog123}@postgres:5432/${POSTGRES_DB:-mediacatalog}?schema=public
      - NEXTAUTH_URL=${NEXTAUTH_URL:-http://localhost:3000}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-your-secret-key-change-in-production}
      - JWT_SECRET=${JWT_SECRET:-your-secret-key-change-in-production}
      - NEXT_PUBLIC_BASE_URL=${NEXT_PUBLIC_BASE_URL:-http://localhost:3000}
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - mediacatalog-network
    command: sh -c "cd /app && npx prisma generate && npx prisma migrate deploy && if [ -f server.js ]; then node server.js; elif [ -f app/server.js ]; then node app/server.js; else echo 'server.js —Ñ–∞–π–ª—ã —Ç–∞–±—ã–ª–º–∞–¥—ã'; exit 1; fi"
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ï–∫—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–µ–≥–µ—Ä “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞)

–ï–≥–µ—Ä –µ–∫—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞, frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–Ω–¥–µ `NEXT_PUBLIC_BASE_URL` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞—É –∫–µ—Ä–µ–∫:

```yaml
frontend:
  environment:
    - NEXT_PUBLIC_BASE_URL=http://backend:3000  # Docker –∂–µ–ª—ñ —ñ—à—ñ–Ω–¥–µ
    # –ë—ñ—Ä–∞“õ –±“±–ª –±—Ä–∞—É–∑–µ—Ä–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–º–µ–π–¥—ñ!
```

**–ú”ô—Å–µ–ª–µ:** Client-side –∫–æ–¥ –±—Ä–∞—É–∑–µ—Ä–¥–µ –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã, —Å–æ–Ω–¥—ã“õ—Ç–∞–Ω `backend:3000` hostname-—ñ–Ω —Ç–∞–±–∞ –∞–ª–º–∞–π–¥—ã.

**–®–µ—à—É:** Reverse proxy –ø–∞–π–¥–∞–ª–∞–Ω—É (nginx) –Ω–µ–º–µ—Å–µ –±—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É.

---

## üìã –¢–µ–∫—Å–µ—Ä—É —Ç—ñ–∑—ñ–º—ñ

### Backend ‚Üî Database
- [x] DATABASE_URL –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- [x] Backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ postgres-–∫–µ “õ–æ—Å—ã–ª–∞ –∞–ª–∞–¥—ã
- [x] Prisma –º–∏–≥—Ä–∞—Ü–∏—è–ª–∞—Ä—ã –¥“±—Ä—ã—Å –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã
- [x] –ë–∞–∑–∞ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ —Å—Ö–µ–º–∞—Å—ã —Å”ô–π–∫–µ—Å

### Frontend ‚Üî Backend
- [x] Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—Ç–µ—Ä `/api/...` –ø–∞–π–¥–∞–ª–∞–Ω–∞–¥—ã (–¥“±—Ä—ã—Å)
- [ ] Server –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—Ç–µ—Ä `NEXT_PUBLIC_BASE_URL` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω (Docker-–¥–∞ –º”ô—Å–µ–ª–µ)
- [ ] Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä –¥“±—Ä—ã—Å –±–∞–π–ª–∞–Ω—ã—Å“õ–∞–Ω

### Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã
- [x] –ë–∞—Ä–ª—ã“õ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä –±—ñ—Ä –∂–µ–ª—ñ–¥–µ
- [x] Backend postgres-–∫–µ “õ–æ—Å—ã–ª–∞ –∞–ª–∞–¥—ã
- [ ] Frontend backend-–∫–µ “õ–æ—Å—ã–ª–∞ –∞–ª–∞–¥—ã (–µ–≥–µ—Ä –±”©–ª–µ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä –±–æ–ª—Å–∞)

---

## üîß –¢“Ø–∑–µ—Ç—É–ª–µ—Ä

### 1. docker-compose.yml-–¥—ã –±—ñ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–≥–µ ”©–∑–≥–µ—Ä—Ç—É (“∞—Å—ã–Ω—ã–ª–∞–¥—ã)

–ï–∫—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–¥—ñ –±—ñ—Ä—ñ–∫—Ç—ñ—Ä—É - Next.js —Å—Ç–∞–Ω–¥–∞—Ä—Ç—Ç—ã –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Å—ã–Ω–∞ —Å”ô–π–∫–µ—Å.

### 2. –ù–µ–º–µ—Å–µ frontend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ–Ω–¥–µ NEXT_PUBLIC_BASE_URL –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞—É

–ï–≥–µ—Ä –µ–∫—ñ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É “õ–∞–∂–µ—Ç –±–æ–ª—Å–∞, reverse proxy –ø–∞–π–¥–∞–ª–∞–Ω—É –∫–µ—Ä–µ–∫.

---

**–î–∞—Ç–∞:** 2024
**–°—Ç–∞—Ç—É—Å:** –ú”ô—Å–µ–ª–µ–ª–µ—Ä –∞–Ω—ã“õ—Ç–∞–ª–¥—ã, —à–µ—à—É “õ–∞–∂–µ—Ç ‚ö†Ô∏è

