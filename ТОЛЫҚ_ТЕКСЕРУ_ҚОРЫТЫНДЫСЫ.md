# –¢–æ–ª—ã“õ –¢–µ–∫—Å–µ—Ä—É “ö–æ—Ä—ã—Ç—ã–Ω–¥—ã—Å—ã

## ‚úÖ –û—Ä—ã–Ω–¥–∞–ª“ì–∞–Ω —Ç“Ø–∑–µ—Ç—É–ª–µ—Ä

### 1. **Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã** ‚úÖ

#### –¢“Ø–∑–µ—Ç—ñ–ª–≥–µ–Ω –º”ô—Å–µ–ª–µ–ª–µ—Ä:
- ‚úÖ Healthcheck –∫–æ–º–∞–Ω–¥–∞—Å—ã –¥“±—Ä—ã—Å—Ç–∞–ª–¥—ã (wget –ø–∞–π–¥–∞–ª–∞–Ω—É)
- ‚úÖ Dockerfile-–¥–∞ wget “õ–æ—Å—ã–ª–¥—ã (healthcheck “Ø—à—ñ–Ω)
- ‚úÖ Server.js —Ñ–∞–π–ª—ã–Ω —Ç–∞–±—É –ª–æ–≥–∏–∫–∞—Å—ã –∂–∞“õ—Å–∞—Ä—Ç—ã–ª–¥—ã (exec –ø–∞–π–¥–∞–ª–∞–Ω—É)
- ‚úÖ Debug –∞“õ–ø–∞—Ä–∞—Ç “õ–æ—Å—ã–ª–¥—ã

**”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä:**
```dockerfile
# Dockerfile
RUN apk add --no-cache wget  # Healthcheck “Ø—à—ñ–Ω

# CMD –∫–æ–º–∞–Ω–¥–∞—Å—ã
CMD ["sh", "-c", "if [ -f server.js ]; then exec node server.js; elif [ -f app/server.js ]; then exec node app/server.js; else echo '“ö–ê–¢–ï: server.js —Ñ–∞–π–ª—ã —Ç–∞–±—ã–ª–º–∞–¥—ã!'; find /app -name 'server.js' -type f 2>&1; exit 1; fi"]
```

```yaml
# docker-compose.yml
healthcheck:
  test: ["CMD-SHELL", "wget --no-verbose --tries=1 --spider http://localhost:3000/api/movies || exit 1"]
```

---

### 2. **–ë–∞–∑–∞ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ —Å—Ö–µ–º–∞—Å—ã** ‚úÖ

#### –¢–µ–∫—Å–µ—Ä—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ:
- ‚úÖ `watch_url` –±–∞“ì–∞–Ω–∞—Å—ã `media_items` –∫–µ—Å—Ç–µ—Å—ñ–Ω–¥–µ –±–∞—Ä
- ‚úÖ `favorites` –∫–µ—Å—Ç–µ—Å—ñ “õ–æ—Å—ã–ª–¥—ã
- ‚úÖ `favorites` –∫–µ—Å—Ç–µ—Å—ñ “Ø—à—ñ–Ω –∏–Ω–¥–µ–∫—Å—Ç–µ—Ä “õ–æ—Å—ã–ª–¥—ã
- ‚úÖ `auth_schema.sql` Docker –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è—Å—ã–Ω–∞ “õ–æ—Å—ã–ª–¥—ã
- ‚úÖ Prisma schema –º–µ–Ω SQL schema —Å”ô–π–∫–µ—Å

**–°—Ö–µ–º–∞ —Å”ô–π–∫–µ—Å—Ç—ñ–≥—ñ:**
| Prisma Model | SQL Table | –°—Ç–∞—Ç—É—Å |
|-------------|-----------|--------|
| `MediaItem` | `media_items` | ‚úÖ –°”ô–π–∫–µ—Å (watch_url –±–∞—Ä) |
| `Favorite` | `favorites` | ‚úÖ –°”ô–π–∫–µ—Å |
| `User` | `users` | ‚úÖ –°”ô–π–∫–µ—Å (auth_schema.sql) |
| `Account` | `accounts` | ‚úÖ –°”ô–π–∫–µ—Å (auth_schema.sql) |
| `Session` | `sessions` | ‚úÖ –°”ô–π–∫–µ—Å (auth_schema.sql) |

---

### 3. **Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã** ‚úÖ

#### –¢–µ–∫—Å–µ—Ä—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ:
- ‚úÖ `output: 'standalone'` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- ‚úÖ TypeScript –∂”ô–Ω–µ ESLint “õ–∞—Ç–µ–ª–µ—Ä—ñ –µ–ª–µ–º–µ–π–¥—ñ (–¥–∞–º—ã—Ç—É “Ø—à—ñ–Ω)
- ‚úÖ Images unoptimized (Docker “Ø—à—ñ–Ω –¥“±—Ä—ã—Å)

**next.config.mjs:**
```javascript
{
  output: 'standalone',  // ‚úÖ Docker “Ø—à—ñ–Ω –¥“±—Ä—ã—Å
  images: { unoptimized: true },  // ‚úÖ Docker “Ø—à—ñ–Ω –¥“±—Ä—ã—Å
}
```

---

### 4. **API Routes** ‚úÖ

#### –¢–µ–∫—Å–µ—Ä—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ:
- ‚úÖ –ë–∞—Ä–ª—ã“õ API routes –¥“±—Ä—ã—Å —ç–∫—Å–ø–æ—Ä—Ç—Ç–∞–ª“ì–∞–Ω
- ‚úÖ Fallback –º–µ—Ö–∞–Ω–∏–∑–º–¥–µ—Ä –±–∞—Ä
- ‚úÖ “ö–∞—Ç–µ–ª–µ—Ä –¥“±—Ä—ã—Å ”©“£–¥–µ–ª–µ–¥—ñ

**API Routes:**
- `/api/movies` - ‚úÖ –î“±—Ä—ã—Å
- `/api/books` - ‚úÖ –î“±—Ä—ã—Å
- `/api/games` - ‚úÖ –î“±—Ä—ã—Å
- `/api/search` - ‚úÖ –î“±—Ä—ã—Å
- `/api/auth/*` - ‚úÖ –î“±—Ä—ã—Å
- `/api/users/*` - ‚úÖ –î“±—Ä—ã—Å
- `/api/favorites` - ‚úÖ –î“±—Ä—ã—Å

---

### 5. **Environment Variables** ‚úÖ

#### –¢–µ–∫—Å–µ—Ä—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ:
- ‚úÖ `DATABASE_URL` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- ‚úÖ `JWT_SECRET` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- ‚úÖ `NEXT_PUBLIC_BASE_URL` –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- ‚úÖ Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã –æ–ø—Ü–∏–æ–Ω–∞–ª–¥—ã (–¥“±—Ä—ã—Å ”©“£–¥–µ–ª–µ–¥—ñ)

**“ö–∞–∂–µ—Ç—Ç—ñ –∞–π–Ω—ã–º–∞–ª—ã–ª–∞—Ä:**
```env
DATABASE_URL=postgresql://mediacatalog:mediacatalog123@postgres:5432/mediacatalog?schema=public
JWT_SECRET=your-secret-key-change-in-production
NEXT_PUBLIC_BASE_URL=http://localhost:3000
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your-secret-key-change-in-production
```

---

### 6. **Build –ø—Ä–æ—Ü–µ—Å—Å** ‚úÖ

#### –¢–µ–∫—Å–µ—Ä—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ:
- ‚úÖ Multi-stage build –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- ‚úÖ Prisma generate build –∫–µ–∑—ñ–Ω–¥–µ –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã
- ‚úÖ Standalone output –¥“±—Ä—ã—Å “õ“±—Ä—ã–ª–∞–¥—ã
- ‚úÖ Prisma –∫–ª–∏–µ–Ω—Ç—ñ –¥“±—Ä—ã—Å –∫”©—à—ñ—Ä—ñ–ª–µ–¥—ñ

**Build “õ–∞–¥–∞–º–¥–∞—Ä—ã:**
1. Dependencies –æ—Ä–Ω–∞—Ç—É ‚úÖ
2. Prisma generate ‚úÖ
3. Next.js build ‚úÖ
4. Standalone output –∫”©—à—ñ—Ä—É ‚úÖ
5. Prisma –∫–ª–∏–µ–Ω—Ç—ñ–Ω –∫”©—à—ñ—Ä—É ‚úÖ

---

### 7. **Server.js –∂–æ–ª—ã** ‚úÖ

#### –¢“Ø–∑–µ—Ç—ñ–ª–≥–µ–Ω –º”ô—Å–µ–ª–µ–ª–µ—Ä:
- ‚úÖ Server.js —Ñ–∞–π–ª—ã–Ω —Ç–∞–±—É –ª–æ–≥–∏–∫–∞—Å—ã –∂–∞“õ—Å–∞—Ä—Ç—ã–ª–¥—ã
- ‚úÖ Exec –ø–∞–π–¥–∞–ª–∞–Ω—É (process replacement)
- ‚úÖ Debug –∞“õ–ø–∞—Ä–∞—Ç “õ–æ—Å—ã–ª–¥—ã

**–õ–æ–≥–∏–∫–∞:**
```bash
if [ -f server.js ]; then exec node server.js
elif [ -f app/server.js ]; then exec node app/server.js
else find /app -name 'server.js' -type f; exit 1
fi
```

---

### 8. **–ü–æ—Ä—Ç—Ç–∞—Ä –∂”ô–Ω–µ –±–∞–π–ª–∞–Ω—ã—Å—Ç–∞—Ä** ‚úÖ

#### –¢–µ–∫—Å–µ—Ä—É –Ω”ô—Ç–∏–∂–µ–ª–µ—Ä—ñ:
- ‚úÖ App –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –ø–æ—Ä—Ç 3000-–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ
- ‚úÖ Postgres –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ñ –ø–æ—Ä—Ç 5432-–¥–µ –∂“±–º—ã—Å —ñ—Å—Ç–µ–π–¥—ñ
- ‚úÖ –ë–∞—Ä–ª—ã“õ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä –±—ñ—Ä –∂–µ–ª—ñ–¥–µ
- ‚úÖ Healthcheck –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω

**–ü–æ—Ä—Ç—Ç–∞—Ä:**
- App: `3000:3000` ‚úÖ
- Postgres: `5432:5432` ‚úÖ

**–ë–∞–π–ª–∞–Ω—ã—Å—Ç–∞—Ä:**
- App ‚Üí Postgres: `postgres:5432` ‚úÖ
- –ë–∞—Ä–ª—ã“õ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä: `mediacatalog-network` ‚úÖ

---

## üìã –¢–æ–ª—ã“õ —Ç–µ–∫—Å–µ—Ä—É —Ç—ñ–∑—ñ–º—ñ

### Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã
- [x] docker-compose.yml –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- [x] Dockerfile –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- [x] Healthcheck –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- [x] –ü–æ—Ä—Ç—Ç–∞—Ä –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- [x] –ë–∞–π–ª–∞–Ω—ã—Å—Ç–∞—Ä –¥“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω

### –ë–∞–∑–∞ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ
- [x] Prisma schema –¥“±—Ä—ã—Å
- [x] SQL schema –¥“±—Ä—ã—Å
- [x] –°—Ö–µ–º–∞–ª–∞—Ä —Å”ô–π–∫–µ—Å
- [x] –ú–∏–≥—Ä–∞—Ü–∏—è–ª–∞—Ä –¥“±—Ä—ã—Å –æ—Ä—ã–Ω–¥–∞–ª–∞–¥—ã

### Next.js
- [x] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥“±—Ä—ã—Å
- [x] Build –ø—Ä–æ—Ü–µ—Å—Å –¥“±—Ä—ã—Å
- [x] Standalone output –¥“±—Ä—ã—Å
- [x] Server.js —Ñ–∞–π–ª—ã –¥“±—Ä—ã—Å —Ç–∞–±—ã–ª–∞–¥—ã

### API Routes
- [x] –ë–∞—Ä–ª—ã“õ routes –¥“±—Ä—ã—Å
- [x] Fallback –º–µ—Ö–∞–Ω–∏–∑–º–¥–µ—Ä –±–∞—Ä
- [x] “ö–∞—Ç–µ–ª–µ—Ä –¥“±—Ä—ã—Å ”©“£–¥–µ–ª–µ–¥—ñ

### Environment Variables
- [x] –ë–∞—Ä–ª—ã“õ “õ–∞–∂–µ—Ç—Ç—ñ –∞–π–Ω—ã–º–∞–ª—ã–ª–∞—Ä –±–∞—Ä
- [x] –î“±—Ä—ã—Å –±–∞–ø—Ç–∞–ª“ì–∞–Ω
- [x] Default –º”ô–Ω–¥–µ—Ä –±–∞—Ä

---

## üöÄ Docker-–¥–∞ —ñ—Å–∫–µ “õ–æ—Å—É

### 1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä–¥—ñ “õ–∞–π—Ç–∞ “õ“±—Ä—É:
```bash
docker-compose down
docker-compose build --no-cache app
docker-compose up -d
```

### 2. –õ–æ–≥—Ç–∞—Ä–¥—ã –∫”©—Ä—É:
```bash
docker-compose logs -f app
```

### 3. –ë—Ä–∞—É–∑–µ—Ä–¥–µ –∞—à—É:
```
http://localhost:3000
```

---

## üîç –ú”ô—Å–µ–ª–µ–ª–µ—Ä–¥—ñ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞–ª–∞—É

### –ï–≥–µ—Ä —Å–∞–π—Ç –∂“±–º—ã—Å —ñ—Å—Ç–µ–º–µ—Å–µ:

1. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–ª–µ—Ä–¥—ñ“£ —Å—Ç–∞—Ç—É—Å—ã–Ω —Ç–µ–∫—Å–µ—Ä—É:**
   ```bash
   docker-compose ps
   ```

2. **–õ–æ–≥—Ç–∞—Ä–¥—ã –∫”©—Ä—É:**
   ```bash
   docker-compose logs app
   docker-compose logs postgres
   ```

3. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —ñ—à—ñ–Ω–µ –∫—ñ—Ä—É:**
   ```bash
   docker-compose exec app sh
   ```

4. **Server.js —Ñ–∞–π–ª—ã–Ω —Ç–µ–∫—Å–µ—Ä—É:**
   ```bash
   docker-compose exec app ls -la /app/server.js
   docker-compose exec app find /app -name "server.js"
   ```

5. **–ë–∞–∑–∞ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã —Ç–µ–∫—Å–µ—Ä—É:**
   ```bash
   docker-compose exec app npx prisma db pull
   ```

---

## ‚úÖ “ö–æ—Ä—ã—Ç—ã–Ω–¥—ã

–ë–∞—Ä–ª—ã“õ –º”ô—Å–µ–ª–µ–ª–µ—Ä —Ç–µ–∫—Å–µ—Ä—ñ–ª–¥—ñ –∂”ô–Ω–µ —Ç“Ø–∑–µ—Ç—ñ–ª–¥—ñ:

1. ‚úÖ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã –¥“±—Ä—ã—Å
2. ‚úÖ –ë–∞–∑–∞ –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ —Å—Ö–µ–º–∞—Å—ã –¥“±—Ä—ã—Å
3. ‚úÖ Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Å—ã –¥“±—Ä—ã—Å
4. ‚úÖ API routes –¥“±—Ä—ã—Å
5. ‚úÖ Environment variables –¥“±—Ä—ã—Å
6. ‚úÖ Build –ø—Ä–æ—Ü–µ—Å—Å –¥“±—Ä—ã—Å
7. ‚úÖ Server.js –∂–æ–ª—ã –¥“±—Ä—ã—Å
8. ‚úÖ –ü–æ—Ä—Ç—Ç–∞—Ä –∂”ô–Ω–µ –±–∞–π–ª–∞–Ω—ã—Å—Ç–∞—Ä –¥“±—Ä—ã—Å

**–°—Ç–∞—Ç—É—Å:** –ë–∞—Ä–ª—ã“õ “õ–∞—Ç–µ–ª–µ—Ä —Ç“Ø–∑–µ—Ç—ñ–ª–¥—ñ ‚úÖ

---

**–î–∞—Ç–∞:** 2024
**–¢–µ–∫—Å–µ—Ä—É:** –¢–æ–ª—ã“õ —Ç–µ–∫—Å–µ—Ä—É –æ—Ä—ã–Ω–¥–∞–ª–¥—ã


